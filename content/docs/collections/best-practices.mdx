---
title: 'Best Practices for Collections'
description: 'Essential techniques and patterns for working with Blutui collections using Canvas'
---

### Always Load Collections

```canvas
{# ✅ CORRECT #}
{% set items = cms.collection('items') %}
{% for item in items %}

{# ❌ INCORRECT #}
{% for item in cms.collection('items') %}  {# Don't load in loop #}
```

### Options Are Simple String Arrays

```json
// ✅ CORRECT
options: ['Option 1', 'Option 2', 'Option 3']

// ❌ INCORRECT
options: [{ label: 'Option 1', value: 'option_1' }]
```

Use exact strings in templates:

```canvas
{% if item.status == 'Active' %}  {# Not 'active' - case matters! #}
```

### File Field Access

```canvas
{# Single file (allow_multiple: false) - direct access as string #}
{{ item.photo }}

{# Multiple files (allow_multiple: true) - array, need loop or index #}
{% for img in item.gallery %}{{ img }}{% endfor %}
{{ item.gallery[0] }}
```

### Use |raw for Rich Text

```canvas
{# ✅ CORRECT #}
{{ item.content|raw }}

{# ❌ INCORRECT - HTML will be escaped #}
{{ item.content }}
```

### Check Before Using Optional Fields

```canvas
{# ✅ CORRECT #}
{% if item.optional_field is not empty %}
  {{ item.optional_field }}
{% endif %}

{# ❌ INCORRECT - may cause errors #}
{{ item.optional_field }}
```

### Use Arrow Functions for Filtering

```canvas
{# ✅ CORRECT - Arrow function syntax #}
items|filter(i => i.status == 'Active')

{# ❌ INCORRECT - This won't work in Canvas #}
items|where('status', 'Active')
```

### Use group_by for Efficiency

```canvas
{# ✅ BETTER - One filter operation #}
{% for category, items in products|group_by('category') %}

{# ❌ LESS EFFICIENT - Filters entire collection multiple times #}
{% set categories = products|column('category')|unique %}
{% for category in categories %}
  {% for item in products|filter(p => p.category == category) %}
```

### Always Format Numbers

```canvas
{# ✅ CORRECT #}
${{ price|number_format(2) }}

{# ❌ INCORRECT - may show too many decimals #}
${{ price }}
```

### Escape Date Format Characters

```canvas
{# ✅ CORRECT #}
{{ date|date('F jS \\a\\t g:ia') }}      {# January 21st at 2:30pm #}

{# ❌ INCORRECT - 'at' will be interpreted as format codes #}
{{ date|date('F jS at g:ia') }}          {# Wrong output #}
```

### Provide Empty State Feedback

```canvas
{# ✅ CORRECT #}
{% for item in items %}
  {{ item.name }}
{% else %}
  <p>No items found</p>
{% endfor %}

{# ❌ INCORRECT - leaves user confused if no items #}
{% for item in items %}
  {{ item.name }}
{% endfor %}
```

---

## Summary

- **Load collections** with `cms.collection()`
- **Filter** with arrow functions: `filter(item => condition)`
- **Sort** with spaceship operator: `sort((a, b) => a.field <=> b.field)`
- **Group** with `group_by('field')`
- **Single files** access directly: `{{ item.photo }}`
- **Multiple files** require loops: `{% for img in item.gallery %}`
- **Rich text** needs `|raw` filter
- **Dates** use canvas format: `date('F j, Y')`
- **Options** are exact strings: `'Active'` not `'active'`
- **Always check** optional fields before use
